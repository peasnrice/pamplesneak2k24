{% extends "default_base.html" %}
{% load static %}

{% block head %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>

$(document).ready(function() {
    var gameId = "{{ game.id }}";  // Assuming game.id is your Django template variable
    var playerId = "{{ player.id }}";  // Assuming player.id is your Django template variable

    async function refreshWord() {
      const url = `/gameroom/ajax/refresh_word/${gameId}/${playerId}/`;  // Corrected URL
      const response = await fetch(url);
      const data = await response.json();
      // Update your DOM based on 'data', e.g.:
      // document.querySelector('#elementToUpdate').innerHTML = data.html;
    }

    setInterval(refreshWord, 10000); // Refresh every second (1000 milliseconds)
    refreshWord();  // Initial call to refresh word

    // Message pop-up logic
    var messageContainer = $('#message-container');
    if (messageContainer.length) {
        // Show the message container for 5 seconds
        messageContainer.fadeIn().delay(5000).fadeOut();
    }

  });
</script>
{% endblock %}

{% block jumbotron %}
<div class="p-4 bg-gray-200 text-center">
  <h1 class="text-3xl font-bold">Welcome to the Pamplesneak game</h1>
  <h2 class="text-2xl">{{ game.game_name }}!</h2>
  <a class="text-white bg-yellow-400 hover:bg-yellow-500 font-bold py-2 px-4 rounded" href="{% url 'gameroom:pampleplay' %}" role="button">Back to Lobby</a>
</div>
{% endblock %}


{% block content %}
<div class="container mx-auto px-4">
    {% if messages %}
        <div id="message-container" class="fixed top-0 left-1/2 transform -translate-x-1/2 bg-green-500 text-white py-2 px-4 rounded-md text-center hidden">
            {% for message in messages %}
                <div class="{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}
</div>

<div class="container mx-auto px-4">
  <div class="my-4">
    {% include "gameroom/playerword.html" %}
  </div>
  <div class="my-4 text-center">
    <button id="random_word_button" class="bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-2 px-4 rounded" onclick="randomize_word();">
      Random Word
    </button>
    <button id="random_player_button" class="bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-2 px-4 rounded" onclick="randomPlayer();">
      Random Player
    </button>
    {% include "gameroom/messageform.html" %}
  </div>
  <div id="collapseStats" class="collapse">
    {% include "gameroom/ingamestats.html" %}
  </div>
</div>
{% endblock %}

<script src="{% static 'js/game_logic.js' %}"></script>
